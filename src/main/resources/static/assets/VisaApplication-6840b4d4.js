import{r as a,a as b,j as e,c as ee,B as f,_ as V}from"./index-2e85eed9.js";import{l as se,C as te}from"./CMSPagination-8551283f.js";import{F as ae}from"./index.es-55149f84.js";import{p as re}from"./index-fb770e0d.js";import{T as le}from"./index-9c37b3d3.js";const oe=e.jsx(ae,{icon:re,style:{color:"green"}}),de=({searchTerm:p})=>{const c=a.useRef(null),x=sessionStorage.getItem("branch"),T=sessionStorage.getItem("role"),A=sessionStorage.getItem("userid");a.useEffect(()=>{R()},[]);const[L,P]=a.useState(!0),[E,y]=a.useState(!1),[n,I]=a.useState([]),[D,O]=a.useState(""),R=async()=>{const s=`${f}/api/visaApplication`,t={branch:x,user_role:T,status:1,type:"normal"};await b.post(s,t).then(l=>{I(l.data),h(l.data),P(!1)}).catch(l=>{console.log(l)})},j=a.useRef(null),[ne,F]=a.useState(!1),[ie,M]=a.useState(!1),[v,h]=a.useState([]),[m,ce]=a.useState([]),[d,B]=a.useState(),[$,w]=a.useState(!1),[o,U]=a.useState("asc"),[N,q]=a.useState(1),g=10,[r,u]=a.useState({driver_name:"",visa_type:"",date_employed:"",applied_for:"",branch:"",passport_number:"",phone:"",notes:"",approval_status:""});a.useEffect(()=>{const s=n.filter(t=>{const l=p.toLowerCase();return t.driver_name.toLowerCase().includes(l)||t.branch.toLowerCase().includes(l)||t.phone.toLowerCase().includes(l)||t.date_employed.toLowerCase().includes(l)||t.applied_for.toLowerCase().includes(l)});h(s)},[p]),a.useLayoutEffect(()=>{const s=m.length>0&&m.length<n.length;F(m.length===n.length),M(s),j.current&&(j.current.indeterminate=s)},[m,n.length]);const K=s=>{q(s)},z=(s,t,l)=>s.sort((Y,Z)=>{const S=Y[t],C=Z[t];return S<C?l==="asc"?-1:1:S>C?l==="asc"?1:-1:0}),i=s=>{const t=d===s&&o==="asc"?"desc":"asc";B(s),U(t);const l=z([...n],s,o);h(l)};function H(s){O(s),b({method:"post",url:`${f}/api/getVisaDetails`,data:{driverId:s}}).then(t=>{u(t.data),y(!0)}).catch(t=>console.log(t.message))}function _(){y(!1)}function J(){r.approval_status!=""&&r.approval_status!=null&&r.approval_status!="null"?(w(!0),b({method:"post",url:`${f}/api/visaApplication`,data:{user:A,approval_status:r.approval_status,driver:D,type:"update_visa"}}).then(s=>{V.success(s.data[0].msg),w(!1)}).catch(s=>console.log(s.message))):V.error("Please enter all the required field")}const k=N*g,G=k-g,Q=v.slice(G,k),W=Math.ceil(v.length/g),X=n.length;return e.jsx(e.Fragment,{children:L?e.jsx(ee,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center h-full bg-black/90 px-4 py-5",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-3xl overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"modal-header flex justify-between items-center p-4 border-b",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Apply For Time Express Visa"}),e.jsx("button",{type:"button",onClick:_,className:"text-gray-500 hover:text-gray-700 transition duration-200",children:"×"})]}),e.jsx("div",{className:"modal-body p-6",children:e.jsxs("form",{id:"myform",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Driver"}),e.jsx("input",{type:"text",id:"driver",name:"driver",defaultValue:r.driver_name,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",disabled:!0}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Visa Application"}),e.jsxs("select",{id:"visa_apply_type",name:"visa_apply_type",onChange:s=>u({...r,applied_for:s.target.value}),defaultValue:r.applied_for||"",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",children:[e.jsx("option",{children:"Select Visa Application"}),e.jsx("option",{value:"Time Express Visa",children:"Time Express Visa"}),e.jsx("option",{value:"Time Express Visa Renewal",children:"Time Express Visa Renewal"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Joined Date"}),e.jsx("input",{type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed",defaultValue:r.date_employed,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Branch"}),e.jsx("input",{type:"text",name:"branch",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed",defaultValue:r.branch,disabled:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Current Visa Type"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",defaultValue:r.visa_type,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Passport Number"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",id:"passport_number",defaultValue:r.passport_number,name:"passport_number",disabled:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",defaultValue:r.phone,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Special notes"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 bg-gray-100",id:"notes",defaultValue:r.notes,onChange:s=>u({...r,notes:s.target.value})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Approval Status"}),e.jsxs("select",{id:"leave_type",name:"leave_type",onChange:s=>u({...r,approval_status:s.target.value}),defaultValue:r.approval_status&&r.approval_status!=""?r.approval_status:"",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",children:[e.jsx("option",{children:"Select Status"}),e.jsx("option",{value:"0",children:"Pending"}),e.jsx("option",{value:"1",children:"Approved"}),e.jsx("option",{value:"2",children:"Rejected"})]})]})})]})}),e.jsxs("div",{className:"modal-footer p-4 border-t flex justify-between",children:[$?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-5 h-5 border-4 border-transparent border-t-white animate-spin rounded-full"}),e.jsx("span",{className:"ml-2",children:"Applying..."})," "]}):e.jsx("button",{type:"button",className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-200",onClick:s=>J(),children:"Apply Visa"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:_,children:"Close"})]})]})}),e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(se.DownloadTableExcel,{filename:"User List",sheet:"vehicles",currentTableRef:c.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:c,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("driver_name"),children:["Full name ",d==="driver_name"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("branch"),children:["Branch ",d==="branch"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("phone"),children:["Mobile ",d==="phone"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("date_employed"),children:["Date Employed ",d==="date_employed"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("applied_for"),children:["Applied For ",d==="applied_for"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("status"),children:["Visa Request ",d==="status"?o==="asc"?"↑":"↓":""]}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:Q.map((s,t)=>e.jsxs("tr",{className:`${t%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:s.driver_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:s.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:s.phone}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:s.date_employed}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:s.applied_for}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:Number.parseInt(s.approval_status,10)==0?e.jsx("p",{style:{textAlign:"left",color:"red"},children:"Pending"}):null}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsx("a",{title:"Apply Leave",id:s.id,onClick:()=>H(s.id),className:"",children:oe})})]},t))})]})]}),e.jsx(te,{currentPage:N,totalPages:W,totalNumbers:X,perNumberPage:10,onPageChange:K})]})})},ge=()=>{const p=[],[c,x]=a.useState("");return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(le,{title:"",btns:p,searchTerm:c,setSearchTerm:x}),e.jsx(de,{searchTerm:c})]})};export{ge as default};
