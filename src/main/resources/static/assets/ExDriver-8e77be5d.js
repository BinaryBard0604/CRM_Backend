import{u as xe,r as l,a as y,j as e,c as ue,B as _,_ as R}from"./index-2e85eed9.js";import{F as C}from"./index.es-55149f84.js";import{c as ge,n as pe,s as he}from"./index-fb770e0d.js";import{l as be,C as ye}from"./CMSPagination-8551283f.js";import{T as _e}from"./index-9c37b3d3.js";const je=e.jsx(C,{icon:ge,style:{color:"blue"}}),ve=e.jsx(C,{icon:pe,style:{color:"blue"}}),we=e.jsx(C,{icon:he,style:{color:"red"}}),Ne=({searchTerm:u})=>{const x=xe(),g=l.useRef(null),[O,$]=l.useState(!0),[A,M]=l.useState(""),[m,B]=l.useState([]),S=l.useRef(null),[ke,K]=l.useState(!1),[Ce,U]=l.useState(!1),[D,j]=l.useState([]),[p,Se]=l.useState([]),[d,q]=l.useState(),[n,H]=l.useState("asc"),[T,z]=l.useState(1),[Y,L]=l.useState(!1),[De,G]=l.useState(!1),v=10,J=sessionStorage.getItem("branch"),Q=sessionStorage.getItem("role"),W=sessionStorage.getItem("userid"),[i,w]=l.useState({filedetails:{resign_form:null,settle_form:null,cancel_form:null}});let N=new Date,h=N.getDate(),b=N.getMonth()+1,X=N.getFullYear();h<10&&(h=0+h),b<10&&(b=0+b);const Z=X+"-"+b+"-"+h;l.useState(Z),l.useEffect(()=>{const t=`${_}/api/getDrivers`;y({method:"post",url:`${t}`,data:{branch:J,user_role:Q,status:0,type:"normal"}}).then(s=>{B(s.data),j(s.data),$(!1)}).catch(s=>console.log(s))},[]),l.useEffect(()=>{const t=m.filter(s=>{const r=u.toLowerCase();return s.full_name.toLowerCase().includes(r)||s.branch.toLowerCase().includes(r)||s.phone.toLowerCase().includes(r)||s.license_expiry_date.toLowerCase().includes(r)||s.date_employed.toLowerCase().includes(r)||s.job_sts.toLowerCase().includes(r)});j(t)},[u]),l.useLayoutEffect(()=>{const t=p.length>0&&p.length<m.length;K(p.length===m.length),U(t),S.current&&(S.current.indeterminate=t)},[p,m.length]);const ee=t=>{z(t)};function te(t){x(`/drivers/edit-driver/${t}`)}function se(t){x(`/drivers/view-vehicles/${t}`)}function k(t,s,r){const o={...i.filedetails};r=="resign_form"?(console.log("???????????????????1"),w({filedetails:{...o,resign_form:t}})):r=="settle_form"?(console.log("???????????????????2"),w({filedetails:{...o,settle_form:t}})):r=="cancel_form"&&(console.log("???????????????????3"),w({filedetails:{...o,cancel_form:t}}))}const ae=(t,s,r)=>t.sort((o,fe)=>{const E=o[s],F=fe[s];return E<F?r==="asc"?-1:1:E>F?r==="asc"?1:-1:0}),f=t=>{const s=d===t&&n==="asc"?"desc":"asc";q(t),H(s);const r=ae([...m],t,n);j(r)},[V,le]=l.useState({driver_name:"",change_date:"",date_employed:"",passport_number:"",id:""});function I(){L(!1)}const[a,c]=l.useState({reason:"",notes:"",type_of_leaving:"",resign_form:"",cancel_date:"",resign_date:"",settle_form:"",cancel_form:"",driver_id:""});function re(t){M(t),y({method:"post",url:`${_}/api/getSettlementDetails`,data:{driverId:t}}).then(s=>{s.data.settlementdetails!=null?c(s.data.settlementdetails):c({...a,reason:"",notes:"",type_of_leaving:"",driver_id:"",cancel_date:"",resign_date:"",resign_form:"",settle_form:"",cancel_form:""}),s.data.joindetails!=null&&le(s.data.joindetails),L(!0)}).catch(s=>console.log(s.message))}function oe(t){t.preventDefault(),console.log(a,i.filedetails),a.cancel_date!=""&&a.resign_date&&a.type_of_leaving&&(a.resign_form!=""||i.filedetails.resign_form!=null)&&(a.settle_form!=""||i.filedetails.settle_form!=null)&&(a.cancel_form!=""||i.filedetails.cancel_form!=null)?y({method:"post",url:`${_}/api/userActions`,data:{user:W,reason:a.reason,notes:a.notes,type_of_leaving:a.type_of_leaving,resign_form:a.resign_form,cancel_date:a.cancel_date,resign_date:a.resign_date,settle_form:a.settle_form,cancel_form:a.cancel_form,driver:A,type:"settle"}}).then(s=>{console.log(">>>>>>>>>>>>>>>>",s.data),s.data>1&&ne(s.data)}).catch(s=>console.log(s.message)):R.error("Please enter all the required fields")}function ne(t){const s=new FormData;s.append("settle_form",i.filedetails.settle_form),s.append("resign_form",i.filedetails.resign_form),s.append("cancel_form",i.filedetails.cancel_form),s.append("settleid",t),s.append("passportno",V.passport_number),s.append("settle_form2",a.settle_form),s.append("resign_form2",a.resign_form),s.append("cancel_form2",a.cancel_form);let r=`${_}/api/settleFileUpload`;y.post(r,s,{}).then(o=>{console.log("heree",o.data),G(!1),R.success(o.data.msg)},o=>{alert(o)})}const P=T*v,ie=P-v,de=D.slice(ie,P),ce=Math.ceil(D.length/v),me=m.length;return e.jsx(e.Fragment,{children:O?e.jsx(ue,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[Y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center h-full bg-black/90 px-4 py-5",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-3xl overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"modal-header flex justify-between items-center p-4 border-b",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Settlement"}),e.jsx("button",{type:"button",onClick:I,className:"text-gray-500 hover:text-gray-700 transition duration-200",children:"×"})]}),e.jsx("div",{className:"modal-body p-6",children:e.jsxs("form",{id:"myform",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Driver"}),e.jsx("input",{type:"text",id:"driver",name:"driver",defaultValue:V.driver_name,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",disabled:!0}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type Of Leaving"}),e.jsxs("select",{id:"leave_type",name:"leave_type",onChange:t=>c({...a,type_of_leaving:t.target.value}),defaultValue:a.type_of_leaving&&a.type_of_leaving!=""?a.type_of_leaving:"",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Resignation",children:"Resignation"}),e.jsx("option",{value:"Termination",children:"Termination"}),e.jsx("option",{value:"Labor Case",children:"Labor Case"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Resigned / Terminated Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",onChange:t=>c({...a,resign_date:t.target.value}),defaultValue:a.resign_date,id:"start",name:"start",onKeyDown:t=>t.preventDefault()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Cancellation Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",id:"end",onChange:t=>c({...a,cancel_date:t.target.value}),defaultValue:a.cancel_date,name:"end",onKeyDown:t=>t.preventDefault()})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reason of Resignation/ Termination"}),e.jsx("textarea",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",rows:3,onChange:t=>c({...a,reason:t.target.value}),name:"notes",defaultValue:a.reason,id:"notes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Special Notes"}),e.jsx("textarea",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",rows:3,onChange:t=>c({...a,notes:t.target.value}),name:"notes",defaultValue:a.notes,id:"notes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Settlement Form ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"file",className:"mt-1 block w-full border border-gray-300 rounded-md",onChange:t=>{const s=t.target.files?t.target.files[0]:null;k(s,1,"settle_form")}}),a.settle_form&&a.settle_form!==""?e.jsx("a",{href:a.settle_form,className:"text-blue-500 hover:underline mt-2 block",target:"_blank",rel:"noopener noreferrer",children:"View Form"}):null]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Cancellation ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"file",className:"mt-1 block w-full border border-gray-300 rounded-md",onChange:t=>{const s=t.target.files?t.target.files[0]:null;k(s,1,"cancel_form")}}),a.cancel_form&&a.cancel_form!==""?e.jsx("a",{href:a.cancel_form,target:"_blank",className:"hover:underline mt-2 block",rel:"noopener noreferrer",children:"View Form"}):null]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Resignation/Termination ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"file",className:"mt-1 block w-full border border-gray-300 rounded-md",onChange:t=>{const s=t.target.files?t.target.files[0]:null;k(s,1,"resign_form")}}),a.resign_form&&a.resign_form!==""?e.jsx("a",{href:a.resign_form,className:"text-blue-500 hover:underline mt-2 block",target:"_blank",rel:"noopener noreferrer",children:"View Form"}):null]})]})]})}),e.jsxs("div",{className:"modal-footer p-4 border-t flex justify-between",children:[e.jsx("button",{type:"button",className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-200",onClick:t=>oe(t),children:"Update Profile"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:I,children:"Close"})]})]})}),e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(be.DownloadTableExcel,{filename:"User List",sheet:"vehicles",currentTableRef:g.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:g,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("full_name"),children:["Full Name ",d==="full_name"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("branch"),children:["Branch ",d==="branch"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("phone"),children:["Mobile ",d==="phone"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("license_expiry_date"),children:["Valid Drivers License ",d==="license_expiry_date"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("date_employed"),children:["Date Employed ",d==="date_employed"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>f("job_sts"),children:["Driver Status ",d==="job_sts"?n==="asc"?"↑":"↓":""]}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Actions"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"View Vehicles"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:de.map((t,s)=>e.jsxs("tr",{className:`${s%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.full_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.license_expiry_date}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.date_employed}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.job_sts}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:[e.jsx("a",{title:"Edit Driver",id:t.id,onClick:()=>te(t.id),className:"",children:ve}),"  ",e.jsx("a",{title:"Apply Visa",id:t.id,onClick:()=>re(t.id),className:"",children:we})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsxs("a",{id:t.id,onClick:()=>se(t.id),style:{marginRight:"5px"},className:"",children:[" ",je]})})]},s))})]})]}),e.jsx(ye,{currentPage:T,totalPages:ce,totalNumbers:me,perNumberPage:10,onPageChange:ee})]})})},Ee=()=>{const u=[],[x,g]=l.useState("");return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(_e,{title:"",btns:u,searchTerm:x,setSearchTerm:g}),e.jsx(Ne,{searchTerm:x})]})};export{Ee as default};
