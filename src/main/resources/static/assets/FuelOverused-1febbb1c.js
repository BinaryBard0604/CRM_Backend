import{u as B,r as s,a as K,j as e,c as Y,B as U}from"./index-2e85eed9.js";import{l as W,C as q}from"./CMSPagination-8551283f.js";import{T as z}from"./TopSearchBarWithDate-08a60a23.js";const G=({searchTerm:u,startDate:o,endDate:n})=>{B();const h=s.useRef(null),p=sessionStorage.getItem("branch"),b=sessionStorage.getItem("role"),[m,x]=s.useState(!1);sessionStorage.getItem("userid");const[l,f]=s.useState([]),S=s.useRef(null),[H,P]=s.useState(!1),[J,V]=s.useState(!1),[j,y]=s.useState([]),[g,Q]=s.useState([]),[i,L]=s.useState(),[c,T]=s.useState("asc"),[N,_]=s.useState(1),w=10,E=`${U}/api/fuelReport`;s.useEffect(()=>{const t=new Date(o),a=new Date(n);o!=""&&n!=""&&t<a&&o.split("-")[0]==n.split("-")[0]&&parseInt(o.split("-")[0],10)>2020&&(x(!0),K({method:"post",url:E,data:{branch:p,user_role:b,start:o,end:n,status:1,type:"excessreport"}}).then(r=>{f(r.data),y(r.data),x(!1),x(!1)}).catch(r=>console.log(r.message)))},[o,n]),s.useEffect(()=>{const t=l.filter(a=>{const r=u.toLowerCase();return a.VehiclePlateNumber.toLowerCase().includes(r)||a.vehtype.toLowerCase().includes(r)||a.driver_name.toLowerCase().includes(r)||a.Volume.toLowerCase().includes(r)||a.total_usage.toLowerCase().includes(r)||a.allowance.toLowerCase().includes(r)});y(t)},[u]),s.useLayoutEffect(()=>{const t=g.length>0&&g.length<l.length;P(g.length===l.length),V(t),S.current&&(S.current.indeterminate=t)},[g,l.length]);const I=t=>{_(t)},O=(t,a,r)=>t.sort(($,A)=>{const C=$[a],k=A[a];return C<k?r==="asc"?-1:1:C>k?r==="asc"?1:-1:0}),d=t=>{const a=i===t&&c==="asc"?"desc":"asc";L(t),T(a);const r=O([...l],t,c);y(r)},v=N*w,D=v-w,F=j.slice(D,v),M=Math.ceil(j.length/w),R=l.length;return e.jsx(e.Fragment,{children:m?e.jsx(Y,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(W.DownloadTableExcel,{filename:"Fuel Overused",sheet:"vehicles",currentTableRef:h.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:h,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("VehiclePlateNumber"),children:["Vehicle No. ",i==="VehiclePlateNumber"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("vehtype"),children:["Vehicle Type. ",i==="vehtype"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("driver_name"),children:["Driver ",i==="driver_name"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("Volume"),children:["Volume ",i==="Volume"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("total_usage"),children:["Total Price ",i==="total_usage"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("allowance"),children:["Monthly Allowance ",i==="allowance"?c==="asc"?"↑":"↓":""]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:F.map((t,a)=>e.jsxs("tr",{className:`${a%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.VehiclePlateNumber}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.vehtype}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.driver_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.Volume}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.total_usage}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.allowance})]},a))})]})]}),e.jsx(q,{currentPage:N,totalPages:M,totalNumbers:R,perNumberPage:10,onPageChange:I})]})})},te=()=>{const u=[],o=new Date;o.getMonth();const n=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,h=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-01`,[p,b]=s.useState(""),[m,x]=s.useState(h),[l,f]=s.useState(n);return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(z,{title:"",btns:u,startDate:m,endDate:l,setStartDate:x,setEndDate:f,searchTerm:p,setSearchTerm:b}),e.jsx(G,{searchTerm:p,startDate:m,endDate:l})]})};export{te as default};
