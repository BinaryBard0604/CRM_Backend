import{u as ye,r,a as g,j as e,c as ve,B as p,_ as u}from"./index-2e85eed9.js";import{F as L}from"./index.es-55149f84.js";import{m as _e,n as je,t as we}from"./index-fb770e0d.js";import{l as Ne,C as Ce}from"./CMSPagination-8551283f.js";import{T as Se}from"./index-9c37b3d3.js";const ke=e.jsx(L,{icon:_e,style:{color:"red"}}),Ae=e.jsx(L,{icon:je,style:{color:"blue"}}),Te=e.jsx(L,{icon:we,style:{color:"orange"}}),Le=({searchTerm:y})=>{const v=ye(),_=r.useRef(null),[q,i]=r.useState(!0),[x,H]=r.useState([]),D=r.useRef(null),[De,J]=r.useState(!1),[Ie,K]=r.useState(!1),[I,S]=r.useState([]),[j,Pe]=r.useState([]),[n,z]=r.useState(),[o,G]=r.useState("asc"),[P,Y]=r.useState(1),[Q,$]=r.useState(!1),k=10,[X,O]=r.useState(1),Z=sessionStorage.getItem("branch"),ee=sessionStorage.getItem("role"),b=sessionStorage.getItem("userid");r.useEffect(()=>{const t=`${p}/api/getVehicles`;g({method:"post",url:`${t}`,data:{branch:Z,user_role:ee,status:1,type:"normal",type2:"all"}}).then(s=>{H(s.data),S(s.data),i(!1)}).catch(s=>console.log(s))},[]),r.useEffect(()=>{const t=x.filter(s=>{const a=y.toLowerCase();return s.serial_no.toLowerCase().includes(a)||s.vehicle_name.toLowerCase().includes(a)||s.plate_number.toLowerCase().includes(a)||s.reg_number.toLowerCase().includes(a)||s.mileage.toLowerCase().includes(a)||s.drivername.toLowerCase().includes(a)||s.branch.toLowerCase().includes(a)||s.purchase_to.toLowerCase().includes(a)||s.assignment_sts.toLowerCase().includes(a)});S(t)},[y]),r.useLayoutEffect(()=>{const t=j.length>0&&j.length<x.length;J(j.length===x.length),K(t),D.current&&(D.current.indeterminate=t)},[j,x.length]);const te=t=>{Y(t)};function se(t,s){s?(alert(s),s.length>2&&alert("You have to close the current assignment of the driver before removing the vehicle")):window.confirm("Are you sure you wish to delete this item?")?V(parseInt(t,10)):V(0)}function V(t){if(t>0){const s=`${p}/api/vehicleAction`;g({method:"post",url:`${s}`,data:{user:b,record:t,type:"delete"}}).then(a=>{window.location.reload()}).catch(a=>console.log(a))}}function ae(t){v(`/vehicles/edit-vehicle/${t}`)}const re=(t,s,a)=>t.sort((h,fe)=>{const U=h[s],W=fe[s];return U<W?a==="asc"?-1:1:U>W?a==="asc"?1:-1:0}),c=t=>{const s=n===t&&o==="asc"?"desc":"asc";z(t),G(s);const a=re([...x],t,o);S(a)},[w,le]=r.useState(""),[A,oe]=r.useState([]),[T,ne]=r.useState([]),[E,ie]=r.useState({reg_number:"",vehicle_name:""}),[l,m]=r.useState({driver_id:"",branch_id:"",from_date:"",from_time:"",to_date:"",to_time:"",notes:"",driver_name:""}),[d,B]=r.useState({driver_id:"",branch_id:"",from_date:"",from_time:"",to_date:"",to_time:"",notes:"",driver_name:""}),[f,N]=r.useState({value:"",label:""});function ce(t){O(1),g({method:"post",url:`${p}/api/vehicelActionDetails`,data:{user:b,record:t,type:"details"}}).then(s=>{console.log(">>>>>>>>>>>>>>>>>>",s.data),le(t),ie(s.data.vehicle_details[0]),oe(s.data.drivers),ne(s.data.branches),s.data.assign_details.length==0?(N({...f,label:"",value:""}),m({...l,driver_id:"",branch_id:"",from_date:"",from_time:"",to_date:"",to_time:"",notes:"",driver_name:""}),B({...d,driver_id:"",branch_id:"",from_date:"",from_time:"",to_date:"",to_time:"",notes:"",driver_name:""})):(m(s.data.assign_details[0]),B(s.data.assign_details[0]),N({...f,label:s.data.assign_details[0].driver_name,value:s.data.assign_details[0].driver_id})),$(!0)}).catch(s=>console.log(s.message))}function F(){$(!1)}function de(t,s){g({method:"post",url:`${p}/api/vehicleActionGetBranch`,data:{user:b,driverid:t,vehicle:w,type:"getbranch"}}).then(a=>{console.log("??????????????",a.data),m({...l,branch_id:a.data.branch_details.branch,driver_id:t}),a.data.message[0].result!==""&&u.error(a.data.message[0].result),O(a.data.allowed[0].result),a.data.allowed[0].result=="0"?(m(d),console.log("ccc-",d.driver_name),N({...f,label:d.driver_name,value:d.driver_id})):N({...f,label:s,value:t})}).catch(a=>console.log(a))}const C=A==null?void 0:A.map(t=>({label:`${t.driver_name}`,value:`${t.id}`})),me=t=>{const s=t.target.value,a=C.find(h=>h.value===s);console.log(">>>>>>>>>>>>>>>>",s,a),a&&de(a.value,a.label)};function he(){parseInt(l.driver_id,10)>0?(i(!0),l.from_date<=l.to_date?g({method:"post",url:`${p}/api/vehicleAction`,data:{user:b,vehicle:w,currentassign:l,type:"assign"}}).then(t=>{i(!1),u.success(t.data),setTimeout(()=>{window.location.reload()},2e3)}).catch(t=>console.log(t.message)):(i(!1),u.error("To Date should be greater or same as from date"))):(i(!1),u.error("Please enter all the required fields"))}function ue(t){window.confirm("Are you sure to close this assignment?")?R(t):R("0")}function R(t){const s=new Date().toJSON().slice(0,10);let a=new Date(l.to_date).toJSON().slice(0,10);parseInt(t,10)>0&&(i(!0),l.from_date<=l.to_date?s>=a?g({method:"post",url:`${p}/api/vehicleAction`,data:{user:b,vehicle:w,currentassign:l,type:"close"}}).then(h=>{i(!1),u.success(h.data),setTimeout(()=>{window.location.reload()},2e3)}).catch(h=>console.log(h.message)):(i(!1),u.error("Closing to Date cannot be a future date.")):(i(!1),u.error("To Date should be greater or same as from date")))}const M=P*k,xe=M-k,ge=I.slice(xe,M),pe=Math.ceil(I.length/k),be=x.length;return e.jsx(e.Fragment,{children:q?e.jsx(ve,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[Q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center h-full bg-black/90 px-4 py-5",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-3xl overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"modal-header flex justify-between items-center p-4 border-b",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Assign Vehicle To Driver"}),e.jsx("button",{type:"button",onClick:F,className:"text-gray-500 hover:text-gray-700 transition duration-200",children:"×"})]}),e.jsx("div",{className:"modal-body p-6",children:e.jsxs("form",{id:"myform",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Vehicle ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"driver",name:"driver",defaultValue:`${E.reg_number}-${E.vehicle_name}`,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",disabled:!0}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Branch ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"branch",name:"branch",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",disabled:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),T&&T!=null?e.jsx(e.Fragment,{children:T.map((t,s)=>e.jsx("option",{value:t.id,selected:t.id==l.branch_id,children:t.branch},s))}):null]})]})]}),e.jsx("div",{className:"gap-6 mt-3",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Driver ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 bg-gray-100",value:f.value,onChange:me,name:"color",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a driver"})," ",C==null?void 0:C.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Assigned From ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"datetime-local",id:"driver",name:"driver",value:l.from_date,onChange:t=>m({...l,from_date:t.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 bg-gray-100"}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Assigned To ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"datetime-local",id:"driver",name:"driver",value:l.to_date,onChange:t=>m({...l,to_date:t.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 bg-gray-100"}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Special Notes"}),e.jsx("textarea",{id:"driver",rows:5,name:"driver",value:l.notes,onChange:t=>m({...l,notes:t.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 bg-gray-100"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{style:{color:"#9c27b0",fontWeight:500},children:"Update Assignment: This will create a new assignment or update the existing assignment."}),e.jsxs("p",{style:{color:"red",fontWeight:500},children:["Close Assignment: this will close the existing assignments of vehicle. Both the driver and vehicle become unassigned( Free ). Please update the Actual ",e.jsx("b",{children:"Assigned To"})," before closing."]})]}),e.jsxs("div",{className:"modal-footer p-4 border-t flex justify-between",children:[e.jsxs("div",{children:[X==1?e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:he,children:"Update Assignment"}):null,d.branch_id&&d.branch_id!=""&&parseInt(d.branch_id,10)>0?e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:()=>ue(w),children:"Close Assignment"}):null]}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:F,children:"Close"})]})]})}),e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(Ne.DownloadTableExcel,{filename:"User List",sheet:"vehicles",currentTableRef:_.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:_,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("serial_no"),children:["Sl.No ",n==="serial_no"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("vehicle_name"),children:["Vehicle Name ",n==="vehicle_name"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("plate_number"),children:["Plate Number ",n==="plate_number"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("reg_number"),children:["Reg.number ",n==="reg_number"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("mileage"),children:["Mileage ",n==="mileage"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("drivername"),children:["Driver ",n==="drivername"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("branch"),children:["Branch ",n==="branch"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("purchase_to"),children:["Rental/ Lease Expiry ",n==="purchase_to"?o==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>c("assignment_sts"),children:["Assignment Status ",n==="assignment_sts"?o==="asc"?"↑":"↓":""]}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:ge.map((t,s)=>e.jsxs("tr",{className:`${s%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.serial_no}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.vehicle_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.plate_number}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.reg_number}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.mileage}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.drivername}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.purchase_to}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsx("div",{children:t.assignment_sts=="Expired"?e.jsx("p",{style:{textAlign:"left",color:"red",fontWeight:"bold"},children:t.assignment_sts}):t.assignment_sts=="Free"?e.jsx("p",{style:{textAlign:"left",color:"blue",fontWeight:"bold"},children:t.assignment_sts}):e.jsx("p",{style:{textAlign:"left",color:"green",fontWeight:"bold"},children:t.assignment_sts})})}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:[e.jsx("a",{title:"Delete Vehicle",id:t.id,onClick:()=>se(t.id,t.drivername),className:"",children:ke}),"   ",e.jsx("a",{title:"Edit Vehicle",id:t.id,onClick:()=>ae(t.id),className:"",children:Ae}),"  ",e.jsx("a",{title:"Assign Leave",id:t.id,onClick:()=>ce(t.id),className:"",children:Te})]})]},s))})]})]}),e.jsx(Ce,{currentPage:P,totalPages:pe,totalNumbers:be,perNumberPage:10,onPageChange:te})]})})},Fe=()=>{const y=[{label:"New",path:"/vehicles/add-vehicle"}],[v,_]=r.useState("");return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(Se,{title:"",btns:y,searchTerm:v,setSearchTerm:_}),e.jsx(Le,{searchTerm:v})]})};export{Fe as default};
