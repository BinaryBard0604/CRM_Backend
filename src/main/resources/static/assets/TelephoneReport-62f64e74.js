import{u as K,r as s,a as V,j as e,c as $,B as U}from"./index-2e85eed9.js";import{l as W,C as q}from"./CMSPagination-8551283f.js";import{T as z}from"./TopSearchBarWithYearMonth-5600c6ec.js";const G=({searchTerm:i,year:n,month:l})=>{K();const p=s.useRef(null),g=sessionStorage.getItem("branch"),h=sessionStorage.getItem("role"),[j,c]=s.useState(!1);sessionStorage.getItem("userid");const[r,f]=s.useState([]),u=s.useRef(null),[H,T]=s.useState(!1),[J,P]=s.useState(!1),[w,b]=s.useState([]),[x,Q]=s.useState([]),[m,R]=s.useState(),[d,E]=s.useState("asc"),[v,L]=s.useState(1),y=10,I=`${U}/api/otherReport`;s.useEffect(()=>{n!=""&&l!=""&&(c(!0),V({method:"post",url:I,data:{branch:g,user_role:h,year:n,month:l,status:1,type:"telephone"}}).then(t=>{f(t.data),b(t.data),c(!1),c(!1)}).catch(t=>console.log(t.message)))},[n,l]),s.useEffect(()=>{const t=r.filter(a=>{const o=i.toLowerCase();return a.phone.toLowerCase().includes(o)||a.driver_name.toLowerCase().includes(o)||a.amount.toLowerCase().includes(o)});b(t)},[i]),s.useLayoutEffect(()=>{const t=x.length>0&&x.length<r.length;T(x.length===r.length),P(t),u.current&&(u.current.indeterminate=t)},[x,r.length]);const D=t=>{L(t)},_=(t,a,o)=>t.sort((B,F)=>{const k=B[a],C=F[a];return k<C?o==="asc"?-1:1:k>C?o==="asc"?1:-1:0}),S=t=>{const a=m===t&&d==="asc"?"desc":"asc";R(t),E(a);const o=_([...r],t,d);b(o)},N=v*y,O=N-y,Y=w.slice(O,N),M=Math.ceil(w.length/y),A=r.length;return e.jsx(e.Fragment,{children:j?e.jsx($,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(W.DownloadTableExcel,{filename:"Telephone Report",sheet:"vehicles",currentTableRef:p.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:p,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>S("phone"),children:["Phone ",m==="phone"?d==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>S("driver_name"),children:["Driver ",m==="driver_name"?d==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>S("amount"),children:["Amount ",m==="amount"?d==="asc"?"↑":"↓":""]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:Y.map((t,a)=>e.jsxs("tr",{className:`${a%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.driver_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.amount})]},a))})]})]}),e.jsx(q,{currentPage:v,totalPages:M,totalNumbers:A,perNumberPage:10,onPageChange:D})]})})},te=()=>{const i=[],[n,l]=s.useState("");let g=new Date().getFullYear();const[h,j]=s.useState(g),[c,r]=s.useState(h.toString()),[f,u]=s.useState("");return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(z,{title:"",btns:i,searchTerm:n,setSearchTerm:l,setYear:r,setMonth:u,thisYear:h}),e.jsx(G,{searchTerm:n,year:c,month:f})]})};export{te as default};
