import{u as W,r as a,a as q,j as e,c as z,B as G}from"./index-2e85eed9.js";import{l as H,C as J}from"./CMSPagination-8551283f.js";import{T as Q}from"./TopSearchBarWithDate-08a60a23.js";const X=({searchTerm:m,startDate:o,endDate:i})=>{W();const p=a.useRef(null),h=sessionStorage.getItem("branch"),b=sessionStorage.getItem("role"),[u,x]=a.useState(!1);sessionStorage.getItem("userid");const[c,f]=a.useState([]),j=a.useRef(null),[Z,D]=a.useState(!1),[ee,E]=a.useState(!1),[k,y]=a.useState([]),[g,te]=a.useState([]),[l,P]=a.useState(),[n,F]=a.useState("asc"),[v,I]=a.useState(1),[w,T]=a.useState(),[_,M]=a.useState(),S=10,K=`${G}/api/kmFuelDriver`;a.useEffect(()=>{const t=new Date(o),r=new Date(i);o!=""&&i!=""&&t<r&&o.split("-")[0]==i.split("-")[0]&&parseInt(o.split("-")[0],10)>2020&&(x(!0),q({method:"post",url:K,data:{branch:h,user_role:b,start:o,end:i,status:1,type:"report"}}).then(s=>{f(s.data),y(s.data),T(s.data[0].select_month),M(s.data[0].prev_month),x(!1),x(!1)}).catch(s=>console.log(s.message)))},[o,i]),a.useEffect(()=>{const t=c.filter(r=>{const s=m.toLowerCase();return r.reg_number.toLowerCase().includes(s)||r.km.toLowerCase().includes(s)||r.km_updated_date.toLowerCase().includes(s)||r.driver_name.toLowerCase().includes(s)||r.branch.toLowerCase().includes(s)||r.km2.toLowerCase().includes(s)||r.driver_name2.toLowerCase().includes(s)||r.total_usage.toLowerCase().includes(s)});y(t)},[m]),a.useLayoutEffect(()=>{const t=g.length>0&&g.length<c.length;D(g.length===c.length),E(t),j.current&&(j.current.indeterminate=t)},[g,c.length]);const R=t=>{I(t)},$=(t,r,s)=>t.sort((V,Y)=>{const C=V[r],L=Y[r];return C<L?s==="asc"?-1:1:C>L?s==="asc"?1:-1:0}),d=t=>{const r=l===t&&n==="asc"?"desc":"asc";P(t),F(r);const s=$([...c],t,n);y(s)},N=v*S,O=N-S,B=k.slice(O,N),A=Math.ceil(k.length/S),U=c.length;return e.jsx(e.Fragment,{children:u?e.jsx(z,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(H.DownloadTableExcel,{filename:"Km Fuel Driver",sheet:"vehicles",currentTableRef:p.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:p,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("reg_number"),children:["Reg. Number ",l==="reg_number"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("km"),children:["KM - ",w," ",l==="km"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("km_updated_date"),children:["Updated Date ",l==="km_updated_date"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("driver_name"),children:["Driver - ",w," ",l==="driver_name"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("branch"),children:["Branch ",l==="branch"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("km2"),children:["KM - ",_," ",l==="km2"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("driver_name2"),children:["Driver - ",_," ",l==="driver_name2"?n==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>d("total_usage"),children:["Fuel ",w," ",l==="total_usage"?n==="asc"?"↑":"↓":""]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:B.map((t,r)=>e.jsxs("tr",{className:`${r%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.reg_number}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km_updated_date}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.driver_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km2}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.driver_name2}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.total_usage})]},r))})]})]}),e.jsx(J,{currentPage:v,totalPages:A,totalNumbers:U,perNumberPage:10,onPageChange:R})]})})},oe=()=>{const m=[],o=new Date;o.getMonth();const i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,p=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-01`,[h,b]=a.useState(""),[u,x]=a.useState(p),[c,f]=a.useState(i);return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(Q,{title:"",btns:m,searchTerm:h,setSearchTerm:b,startDate:u,endDate:c,setStartDate:x,setEndDate:f}),e.jsx(X,{searchTerm:h,startDate:u,endDate:c})]})};export{oe as default};
