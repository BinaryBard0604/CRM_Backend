import{u as ye,r as o,a as x,j as e,c as _e,B as h,_ as K}from"./index-2e85eed9.js";import{F as L}from"./index.es-55149f84.js";import{m as je,p as we,n as Ne}from"./index-fb770e0d.js";import{l as ke,C as Se}from"./CMSPagination-8551283f.js";import{T as Le}from"./index-9c37b3d3.js";const Ce=e.jsx(L,{icon:je,style:{color:"red"}}),De=e.jsx(L,{icon:we,style:{color:"green"}}),Te=e.jsx(L,{icon:Ne,style:{color:"blue"}}),Ae=({searchTerm:g})=>{const f=ye(),v="https://fleetp.com",C=o.useRef(null),[U,q]=o.useState(!0),[d,H]=o.useState([]),D=o.useRef(null),[Pe,z]=o.useState(!1),[Ie,J]=o.useState(!1),[T,w]=o.useState([]),[b,Ee]=o.useState([]),[i,W]=o.useState(),[r,Y]=o.useState("asc"),[A,G]=o.useState(1),[Q,N]=o.useState(!1),[Fe,P]=o.useState(!1),k=10,X=sessionStorage.getItem("branch"),Z=sessionStorage.getItem("role"),I=sessionStorage.getItem("userid"),[y,E]=o.useState({filedetails:{settlement:null,leave_form:null}});let S=new Date,_=S.getDate(),j=S.getMonth()+1,ee=S.getFullYear();_<10&&(_=0+_),j<10&&(j=0+j);const te=ee+"-"+j+"-"+_,[F,Ve]=o.useState(te);o.useEffect(()=>{const t=`${h}/api/staff`;x({method:"post",url:`${t}`,data:{branch:X,user_role:Z,status:1,type:"list"}}).then(a=>{H(a.data.result),w(a.data.result),q(!1)}).catch(a=>console.log(a))},[]),o.useEffect(()=>{const t=d.filter(a=>{const s=g.toLowerCase();return a.full_name.toLowerCase().includes(s)||a.branch.toLowerCase().includes(s)||a.phone.toLowerCase().includes(s)||a.date_employed.toLowerCase().includes(s)||a.leave_approval.toLowerCase().includes(s)||a.job_sts.toLowerCase().includes(s)});w(t)},[g]),o.useLayoutEffect(()=>{const t=b.length>0&&b.length<d.length;z(b.length===d.length),J(t),D.current&&(D.current.indeterminate=t)},[b,d.length]);const ae=t=>{G(t)};function se(t){window.confirm("Are you sure you wish to delete this item?")?V(parseInt(t,10)):V(0)}function V(t){if(t>0){const a=`${h}/api/staff`;x({method:"post",url:`${a}`,data:{user:I,record:t,type:"delete"}}).then(s=>{window.location.reload()}).catch(s=>console.log(s))}}function $(t,a,s){const m={...y.filedetails};s=="settlement"?E({filedetails:{...m,settlement:t}}):s=="leave_form"&&E({filedetails:{...m,leave_form:t}})}const le=(t,a,s)=>t.sort((m,p)=>{const R=m[a],B=p[a];return R<B?s==="asc"?-1:1:R>B?s==="asc"?1:-1:0}),u=t=>{const a=i===t&&r==="asc"?"desc":"asc";W(t),Y(a);const s=le([...d],t,r);w(s)},[l,c]=o.useState({leave_from:"",leave_to:"",notes:"",leave_type:"",staff_id:"",leave_form:"",settlement_form:""}),[n,oe]=o.useState({id:"",staff_name:"",change_date:"",date_employed:""}),[re,$e]=o.useState({driver_name:"",visa_type:"",date_employed:"",branch:"",passport_number:"",phone:"",notes:"",applied_for:""}),[ne,de]=o.useState(""),[ie,ce]=o.useState("");function me(t){x({method:"post",url:`${h}/api/staff`,data:{val:t,type:"search"}}).then(a=>{if(a.data.vacationdetails[0]!=null){if(c(a.data.vacationdetails[0]),a.data.vacationdetails[0].leave_form!==""&&a.data.vacationdetails[0].leave_form){const s=a.data.vacationdetails[0].leave_form.split("uploads/");de(`${v}/uploads/${s[1]}`)}if(a.data.vacationdetails[0].settlement_form!==""&&a.data.vacationdetails[0].settlement_form){const s=a.data.vacationdetails[0].settlement_form.split("uploads/");ce(`${v}/uploads/${s[1]}`)}}else c({...l,leave_from:"",leave_to:"",notes:"",leave_type:"",staff_id:"",leave_form:"",settlement_form:""});a.data.joindetails[0]!=null&&oe(a.data.joindetails[0]),N(!0)}).catch(a=>console.log(a.message))}function O(){N(!1)}const fe=`${h}/api/staffAction`;function ue(t){t.preventDefault(),l&&(l.leave_form||y.filedetails.leave_form)?(P(!0),x({method:"post",url:fe,data:{user:I,leave_from:l.leave_from,leave_to:l.leave_to,notes:l.notes,leave_type:l.leave_type,staff_id:l.staff_id,leave_form:l.leave_form,settlement_form:l.settlement_form,id:n.id,staff_name:n.staff_name,change_date:n.change_date,date_employed:n.date_employed,type:"updateleave"}}).then(a=>{console.log(">>>>>>>>>>>>>>>>>>",a.data),a.data>0&&pe(t,a.data)}).catch(a=>console.log(a.message))):K.error("Please enter all the required fields")}function pe(t,a){t.preventDefault();const s=new FormData;s.append("leave_form",y.filedetails.leave_form),s.append("settlement",y.filedetails.settlement),s.append("settlementform2",l.settlement_form),s.append("vacationid",a),s.append("passportno",re.passport_number),s.append("leaveform2",l.leave_form);let m=`${h}/api/staffVacationFileUpload`;x.post(m,s,{}).then(p=>{P(!1),K.success(p.data),setTimeout(()=>{N(!1),f("/staff/staff-list")},2e3)},p=>{alert(p)})}function xe(t){f(`/staff/staff-edit/${t}`)}const M=A*k,he=M-k,ge=T.slice(he,M),ve=Math.ceil(T.length/k),be=d.length;return e.jsx(e.Fragment,{children:U?e.jsx(_e,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[Q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center h-full bg-black/90 px-4 py-5",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-3xl overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"modal-header flex justify-between items-center p-4 border-b",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Apply Vacation / Leave"}),e.jsx("button",{type:"button",onClick:O,className:"text-gray-500 hover:text-gray-700 transition duration-200",children:"×"})]}),e.jsx("div",{className:"modal-body p-6",children:e.jsxs("form",{id:"myform",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Driver"}),e.jsx("input",{type:"text",id:"driver",name:"driver",defaultValue:n.staff_name,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",disabled:!0}),e.jsx("input",{type:"hidden",id:"driver_id",name:"driver_id",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Leave Type"}),e.jsxs("select",{id:"leave_type",name:"leave_type",onChange:t=>c({...l,leave_type:t.target.value}),defaultValue:l.leave_type||"",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",children:[e.jsx("option",{children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"}),e.jsx("option",{value:"Annual Leave",children:"Annual Leave"}),e.jsx("option",{value:"Local Leave",children:"Local Leave"}),e.jsx("option",{value:"Maternity Leave",children:"Maternity Leave"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Leave From ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",min:F,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",onChange:t=>c({...l,leave_from:t.target.value}),defaultValue:l.leave_from,id:"start",name:"start",onKeyDown:t=>t.preventDefault()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Leave To ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",min:F,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",id:"end",onChange:t=>c({...l,leave_to:t.target.value}),defaultValue:l.leave_to,name:"end",onKeyDown:t=>t.preventDefault()})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Joined Date"}),e.jsx("input",{type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",id:"joined_date",defaultValue:n.date_employed,name:"joined_date",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Change Status Date"}),e.jsx("input",{type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50 cursor-not-allowed bg-gray-100",id:"change_date",defaultValue:n.change_date,name:"change_date",disabled:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Special Notes"}),e.jsx("textarea",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-opacity-50",rows:3,onChange:t=>c({...l,notes:t.target.value}),name:"notes",defaultValue:l.notes,id:"notes"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Leave Form ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"file",className:"mt-1 block w-full border border-gray-300 rounded-md",onChange:t=>{const a=t.target.files?t.target.files[0]:null;$(a,1,"leave_form")}}),l.leave_form&&l.leave_form!==""?e.jsx("a",{href:ne,className:"text-blue-500 hover:underline mt-2 block",target:"_blank",rel:"noopener noreferrer",children:"View Form"}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Settlement Form"}),e.jsx("input",{type:"file",className:"mt-1 block w-full border border-gray-300 rounded-md bg-gray-100",onChange:t=>{const a=t.target.files?t.target.files[0]:null;$(a,1,"settlement")}}),l.settlement_form&&l.settlement_form!==""?e.jsx("a",{href:ie,target:"_blank",className:"hover:underline mt-2 block",rel:"noopener noreferrer",children:"View Form"}):null]})]})]})}),e.jsxs("div",{className:"modal-footer p-4 border-t flex justify-between",children:[e.jsx("button",{type:"button",className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-200",onClick:t=>ue(t),children:"Apply Leave"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded hover:bg-gray-400 transition duration-200",onClick:O,children:"Close"})]})]})}),e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(ke.DownloadTableExcel,{filename:"User List",sheet:"vehicles",currentTableRef:C.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:C,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>u("full_name"),children:["Full Name ",i==="full_name"?r==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>u("branch"),children:["Branch ",i==="branch"?r==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>u("phone"),children:["Mobile ",i==="phone"?r==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>u("date_employed"),children:["Date Employed ",i==="date_employed"?r==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>u("leave_approval"),children:["Leave Request ",i==="leave_approval"?r==="asc"?"↑":"↓":""]}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Status"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:ge.map((t,a)=>e.jsxs("tr",{className:`${a%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.full_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.date_employed}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.leave_approval}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.jsx("p",{style:{textAlign:"left",color:"green",fontWeight:"bold"},children:t.job_sts})}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:[e.jsx("a",{title:"Delete Driver",id:t.id,onClick:()=>se(t.id),className:"",children:Ce}),"   ",e.jsx("a",{title:"Edit Driver",id:t.id,onClick:()=>xe(t.id),className:"",children:Te}),"  ",e.jsx("a",{title:"Apply Leave",id:t.id,onClick:()=>me(t.id),className:"",children:De})]})]},a))})]})]}),e.jsx(Se,{currentPage:A,totalPages:ve,totalNumbers:be,perNumberPage:10,onPageChange:ae})]})})},Ue=()=>{const g=[{label:"New",path:"/drivers/add-driver"}],[f,v]=o.useState("");return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(Le,{title:"",btns:g,searchTerm:f,setSearchTerm:v}),e.jsx(Ae,{searchTerm:f})]})};export{Ue as default};
