import{u as A,r as s,a as U,j as e,c as V,B as Y}from"./index-2e85eed9.js";import{l as W,C as q}from"./CMSPagination-8551283f.js";import{T as z}from"./TopSearchBarWithDate-08a60a23.js";const G=({searchTerm:m,startDate:o,endDate:l})=>{A();const p=s.useRef(null),u=sessionStorage.getItem("branch"),b=sessionStorage.getItem("role"),[h,x]=s.useState(!1);sessionStorage.getItem("userid");const[n,f]=s.useState([]),w=s.useRef(null),[H,v]=s.useState(!1),[J,L]=s.useState(!1),[j,y]=s.useState([]),[g,Q]=s.useState([]),[d,R]=s.useState(),[c,E]=s.useState("asc"),[k,P]=s.useState(1),S=10,I=`${Y}/api/kmReport`;s.useEffect(()=>{const t=new Date(o),a=new Date(l);o!=""&&l!=""&&t<a&&o.split("-")[0]==l.split("-")[0]&&parseInt(o.split("-")[0],10)>2020&&(x(!0),U({method:"post",url:I,data:{branch:u,user_role:b,start:o,end:l,type:"report"}}).then(r=>{f(r.data),y(r.data),x(!1),x(!1)}).catch(r=>console.log(r.message)))},[o,l]),s.useEffect(()=>{const t=n.filter(a=>{const r=m.toLowerCase();return a.reg_number.toLowerCase().includes(r)||a.km.toLowerCase().includes(r)||a.km_updated_date.toLowerCase().includes(r)||a.driver_name.toLowerCase().includes(r)||a.branch.toLowerCase().includes(r)||a.km_status.toLowerCase().includes(r)});y(t)},[m]),s.useLayoutEffect(()=>{const t=g.length>0&&g.length<n.length;v(g.length===n.length),L(t),w.current&&(w.current.indeterminate=t)},[g,n.length]);const T=t=>{P(t)},D=(t,a,r)=>t.sort((B,F)=>{const _=B[a],C=F[a];return _<C?r==="asc"?-1:1:_>C?r==="asc"?1:-1:0}),i=t=>{const a=d===t&&c==="asc"?"desc":"asc";R(t),E(a);const r=D([...n],t,c);y(r)},N=k*S,M=N-S,$=j.slice(M,N),K=Math.ceil(j.length/S),O=n.length;return e.jsx(e.Fragment,{children:h?e.jsx(V,{}):e.jsxs("div",{className:"flex-1 flex justify-between flex-col rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1 min-w-[900px]",children:[e.jsxs("div",{className:"relative overflow-x-scroll",children:[e.jsx(W.DownloadTableExcel,{filename:"Km Report",sheet:"vehicles",currentTableRef:p.current,children:e.jsx("button",{className:"bg-blue-500 font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-300",children:"Export Excel"})}),e.jsxs("table",{ref:p,className:"min-w-full table-fixed divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4 border-[#aaaaaa] border-b border-t",children:[e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("reg_number"),children:["Reg. Number ",d==="reg_number"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("km"),children:["KM ",d==="km"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("km_updated_date"),children:["Updated Date ",d==="km_updated_date"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("driver_name"),children:["Driver ",d==="driver_name"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("branch"),children:["Branch ",d==="branch"?c==="asc"?"↑":"↓":""]}),e.jsxs("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",onClick:()=>i("km_status"),children:["Status ",d==="km_status"?c==="asc"?"↑":"↓":""]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:$.map((t,a)=>e.jsxs("tr",{className:`${a%2===1?"bg-gray-2 dark:bg-meta-4":"dark:bg-boxdark"} hover:cursor-pointer border-b border-[#aaaaaa]`,children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.reg_number}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km_updated_date}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.driver_name}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.branch}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:t.km_status})]},a))})]})]}),e.jsx(q,{currentPage:k,totalPages:K,totalNumbers:O,perNumberPage:10,onPageChange:T})]})})},te=()=>{const m=[],o=new Date;o.getMonth();const l=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,p=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-01`,[u,b]=s.useState(""),[h,x]=s.useState(p),[n,f]=s.useState(l);return e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 ",children:[e.jsx(z,{title:"",btns:m,searchTerm:u,setSearchTerm:b,startDate:h,endDate:n,setStartDate:x,setEndDate:f}),e.jsx(G,{searchTerm:u,startDate:h,endDate:n})]})};export{te as default};
